<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title> | 七罪的前端学习小天地</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">七罪的前端学习小天地</h1><a id="logo" href="/.">七罪的前端学习小天地</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Accueil</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> À propos</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">Aug 29, 2018</div><div class="post-content"><p>#自定义指令的学习归纳</p>
<p>##属性型指令</p>
<p>###属性型指令的概念<br>属性型指令用于改变DOM元素的外观或者行为。</p>
<p>###自定义属性型指令建立步骤</p>
<ul>
<li>首先定义一个相应的指令文件。</li>
</ul>
<p>定义一个基础的指令文件，方便等下进行相应的功能添加。</p>
<pre><code>import { Directive, ElementRef } from &apos;@angular/core&apos;;

@Directive({
    selector: &apos;[phone-number]&apos;
})

export class PhoneNumberDirective{
    constructor(private elemenet:ElementRef){
        console.log(this.elemenet);
    }
}
</code></pre><ul>
<li>在根模组中导入指令</li>
</ul>
<p>同时还要使用declarations声明成内部成员变量</p>
<pre><code>import { PhoneNumberDirective } from &apos;./PhoneNumberDirective&apos;;


@NgModule({
  declarations: [
    AppComponent,
    PhoneNumberDirective
  ],
  imports: [...],
  providers: [...],
  bootstrap: [...]
})
export class AppModule { }
</code></pre><ul>
<li>然后在模板中进行使用</li>
</ul>
<p>把选择器名称添加进模板里就可以进行使用了。</p>
<pre><code>&lt;label&gt;
  请输入你的手机号码
  &lt;input name=&quot;phone-number&quot; type=&quot;text&quot; placeholder=&quot;请输入您的手机号码&quot; phone-number&gt;
&lt;/label&gt;
</code></pre><ul>
<li>使用HostListener添加事件监听</li>
</ul>
<p>利用键盘事件监听，完成相应的功能</p>
<pre><code>import { Directive, HostListener } from &apos;@angular/core&apos;;

@Directive({
    ...
})

export class PhoneNumberDirective{
    @HostListener(&apos;input&apos;,[&apos;$event&apos;])
    onkeydown(event:KeyboardEvent){
        const input = event.target as HTMLInputElement;

        let trimmed = input.value.replace(/\s+/g,&apos;&apos;);

        if(trimmed.length &gt; 11){
            trimmed = trimmed.substr(0,11);
        }

        let numbers = [];

        numbers.push(trimmed.substr(0,3));

        for(let i=3;i&lt;trimmed.length;i+=4){
            numbers.push(trimmed.substr(i,4));
        }
        input.value = numbers.join(&apos; &apos;);
    }
}
</code></pre><ul>
<li>使用HostBinding来设置宿主元素的属性</li>
</ul>
<p>先在指令文件中的组件类里使用HostBinding装饰器，这里设置的是宿主元素的边框。</p>
<pre><code>@HostBinding(&apos;sytle.border&apos;)
border:string;
</code></pre><p>然后在onkeydown方法里新增以下代码：</p>
<pre><code>this.border = &apos;&apos;;
if(/[^\d]+/.test(trimmed)){
    this.border = &apos;5px solid red&apos;;
}
</code></pre><ul>
<li>指令文件的所有整体代码如下</li>
</ul>
<p>这里需要注意，@HostBinding装饰器必须写在@HostListener装饰器之前，否则会出现报错的情况。</p>
<pre><code>import { Directive, ElementRef, HostListener, HostBinding } from &apos;@angular/core&apos;;

@Directive({
    selector: &apos;[phone-number]&apos;
})

export class PhoneNumberDirective{
    @HostBinding(&apos;style.border&apos;)
    border:string;

    @HostListener(&apos;input&apos;,[&apos;$event&apos;])
    onkeydown(event:KeyboardEvent){
        const input = event.target as HTMLInputElement;

        let trimmed = input.value.replace(/\s+/g,&apos;&apos;);

        if(trimmed.length &gt; 11){
            trimmed = trimmed.substr(0,11);
        }

        let numbers = [];

        numbers.push(trimmed.substr(0,3));

        for(let i=3;i&lt;trimmed.length;i+=4){
            numbers.push(trimmed.substr(i,4));
        }
        input.value = numbers.join(&apos; &apos;);

        this.border = &apos;&apos;;
        if(/[^\d]+/.test(trimmed)){
            this.border = &apos;5px solid red&apos;;
        }
    }
}
</code></pre><p>###整体思路总结</p>
<blockquote>
<p>自定义属性指令的构建整体思路：</p>
</blockquote>
<blockquote>
<p>创建指令文件 -&gt; 根模组导入 -&gt; 模板里使用 -&gt; 使用HostListener完成事件监听，并且写出需要的事件代码 -&gt; 使用HostBinding来控制宿主元素的属性值。</p>
</blockquote>
<p>###过程中所遇问题<br>在电话间隔的功能实现过程中，由于代码循环条件和循环代码的嵌套结构出错，导致循环条件无限循环，控制台的日志情况在无限增长，出现了无法关闭的情况。<br>后续重新修改，但是未修改循环条件（i+=4写成i+4），然后一输入就会出现了“devtools was disconnected from the page的问题”，并且页面直接崩溃。</p>
<blockquote>
<p>反思：需要在写循环方法等的嵌套结构时，先理清一个整体的思路，再进行结构的编写。同时要对一些常见的代码条件等进行严谨的审查。</p>
</blockquote>
<p>##自定义结构指令</p>
<p>###自定义结构指令的概念<br>结构指令用于动态添加或删除DOM结构，以此来改变DOM的布局。</p>
<p>###自定义结构指令建立步骤</p>
<ul>
<li>首先也是创建一个基础的指令文件</li>
</ul>
<p>定义一个基础的指令文件，方便等下进行相应的功能添加。</p>
<pre><code>import { Directive } from &apos;@angular/core&apos;;

@Directive({
 selector: &apos;[unless]&apos;
})
export class UnlessDirective {}
</code></pre><ul>
<li>在根模组中导入指令</li>
</ul>
<p>同时还要使用declarations声明成内部成员变量</p>
<pre><code>import { UnlessDirective } from &apos;./PhoneNumberDirective&apos;;


@NgModule({
  declarations: [
    ...,
    UnlessDirective
  ],
  imports: [...],
  providers: [...],
  bootstrap: [...]
})
export class AppModule { }
</code></pre><ul>
<li>在模型中使用</li>
</ul>
<p>结构指令需要用到*号</p>
<pre><code>import { Component } from &apos;@angular/core&apos;;

@Component({
  selector: &apos;app-root&apos;,
  template: `
    &lt;div *heyUnless=&quot;condition&quot;&gt;Hey,man&lt;/div&gt;
    &lt;button (click)=&quot;condition=!condition&quot; style=&quot;margin-top:50px;&quot;&gt;点我&lt;/button&gt;
  `,
  styleUrls: [&apos;./app.component.css&apos;]
})
export class AppComponent {

}
</code></pre><ul>
<li>使用Input、TemplateRef和ViewContainerRef来构建指令的内部功能</li>
</ul>
<p>TemplateRef和ViewContainerRef需要注入到构造函数中，设置成该指令的私有类。</p>
<pre><code>import { Directive, Input, TemplateRef, ViewContainerRef } from &quot;@angular/core&quot;;


@Directive({
    selector: &apos;[heyUnless]&apos;
})
export class UnlessDirective{
    constructor(
        private templateRef: TemplateRef&lt;any&gt;,
        private viewContainer: ViewContainerRef
    ){}

    @Input(&apos;heyUnless&apos;)
    set condition(newCondition:boolean){
        if(!newCondition){
            this.viewContainer.createEmbeddedView(this.templateRef);
        }else{
            this.viewContainer.clear();
        }
    }
}
</code></pre><p>###整体思路总结</p>
<blockquote>
<p>自定义结构指令的构建整体思路：</p>
</blockquote>
<blockquote>
<p>创建指令文件 -&gt; 根模组导入 -&gt; 模板里使用 -&gt; 使用Input、TemplateRef和ViewContainerRef来构建指令的内部功能</p>
</blockquote>
<p>##自定义指令的使用感受</p>
<blockquote>
<p>自定义指令分为三种，还有一种是组件，组件是拥有模板的指令。</p>
</blockquote>
<blockquote>
<p>自定义属性指令和自定义结构指令两个指令的作用不同，属性指令用来改变一个DOM元素的外观或者行为，结构指令用来改变HTML的布局，塑造或者重塑DOM结构。根据作用来看的话，个人觉得自定义属性指令的适用范围会更广，频率会更高。</p>
</blockquote>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/09/03/依赖注入学习归纳/"></a><a class="next" href="/2018/08/29/表单学习归纳/"></a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Catégories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Récent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/06/博客说明/">博客说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/04/管道的学习归纳/">管道的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/03/依赖注入学习归纳/">依赖注入学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/29/自定义指令的学习归纳/">自定义指令的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/29/表单学习归纳/">表单学习归纳</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> À suivre</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">七罪的前端学习小天地.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>