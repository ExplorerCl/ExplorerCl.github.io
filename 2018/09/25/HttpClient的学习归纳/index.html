<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="angular"><title>HttpClient的学习归纳 | 七罪的前端学习小天地</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">HttpClient的学习归纳</h1><a id="logo" href="/.">七罪的前端学习小天地</a><p class="description">欢迎一起来探索前端的道路</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">HttpClient的学习归纳</h1><div class="post-meta">Sep 25, 2018<span> | </span><span class="category"><a href="/categories/Angular/">Angular</a></span></div><div class="post-content"><h1 id="HttpClient请求"><a href="#HttpClient请求" class="headerlink" title="HttpClient请求"></a>HttpClient请求</h1><p>HttpClient有五种请求。</p>
<ul>
<li>get</li>
<li>post</li>
<li>patsh</li>
<li>put</li>
<li>delete</li>
</ul>
<h2 id="导入HttpClientModule模块"><a href="#导入HttpClientModule模块" class="headerlink" title="导入HttpClientModule模块"></a>导入HttpClientModule模块</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import &#123; BrowserModule &#125; from &apos;@angular/platform-browser&apos;;</span><br><span class="line">import &#123; NgModule &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; HttpClientModule &#125; from &apos;@angular/common/http&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; AppComponent &#125; from &apos;./app.component&apos;;</span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  declarations: [</span><br><span class="line">    AppComponent</span><br><span class="line">  ],</span><br><span class="line">  imports: [</span><br><span class="line">    BrowserModule,</span><br><span class="line">    HttpClientModule</span><br><span class="line">  ],</span><br><span class="line">  providers: [],</span><br><span class="line">  bootstrap: [AppComponent]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppModule &#123; &#125;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="设置json-server"><a href="#设置json-server" class="headerlink" title="设置json-server"></a>设置json-server</h2><p>使用json-server来模拟服务端数据，方便我们进行demo的实际测试。</p>
<p>json文件内容如下</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;gww&quot;,</span><br><span class="line">      &quot;id&quot;: &quot;1&quot;,</span><br><span class="line">      &quot;age&quot;: &quot;30&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;ExplorerCl&quot;,</span><br><span class="line">      &quot;id&quot;: &quot;2&quot;,</span><br><span class="line">      &quot;age&quot;: &quot;23&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;vue&quot;,</span><br><span class="line">      &quot;id&quot;: &quot;3&quot;,</span><br><span class="line">      &quot;age&quot;: &quot;24&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;tao&quot;,</span><br><span class="line">      &quot;id&quot;: &quot;4&quot;,</span><br><span class="line">      &quot;age&quot;: &quot;25&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;san&quot;,</span><br><span class="line">      &quot;id&quot;: &quot;5&quot;,</span><br><span class="line">      &quot;age&quot;: &quot;26&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>设置好文件之后启动json-server</p>
</blockquote>
<h2 id="Get请求"><a href="#Get请求" class="headerlink" title="Get请求"></a>Get请求</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; HttpClient, HttpParams, HttpHeaders &#125; from &apos;@angular/common/http&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; Observable &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; tap &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">interface User &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  id: number;</span><br><span class="line">  age: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;app-root&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;ul *ngIf=&quot;user$ | async as users else noData&quot;&gt;</span><br><span class="line">      &lt;li *ngFor=&quot;let user of users&quot;&gt;</span><br><span class="line">        &lt;span&gt;Name: &#123;&#123;user.name&#125;&#125;&lt;/span&gt; | </span><br><span class="line">        &lt;span&gt;id: &#123;&#123;user.id&#125;&#125;&lt;/span&gt; | </span><br><span class="line">        &lt;span&gt;age: &#123;&#123;user.age&#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  `,</span><br><span class="line">  styleUrls: [&apos;./app.component.css&apos;]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  user$: Observable&lt;User[]&gt;;</span><br><span class="line">  constructor(private http: HttpClient) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.user$ = this.http</span><br><span class="line">      .get&lt;User[]&gt;(</span><br><span class="line">        &apos;http://localhost:3000/user&apos;</span><br><span class="line">      )</span><br><span class="line">      .pipe(tap(console.log));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>tap标签用来监听Observable的生命周期事件，并且不会产生干扰。</p>
</blockquote>
<blockquote>
<p>asycn as为异步请求，noData用于检测数据的上报异常。</p>
</blockquote>
<blockquote>
<p>subscribe也可以用于获取请求结果，不过与Observable的类型有差别，所以需要做一些修改。</p>
</blockquote>
<h3 id="使用HttpParams对象"><a href="#使用HttpParams对象" class="headerlink" title="使用HttpParams对象"></a>使用HttpParams对象</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; HttpClient, HttpParams, HttpHeaders &#125; from &apos;@angular/common/http&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; Observable &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; tap &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">interface User &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  id: number;</span><br><span class="line">  age: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const params = new HttpParams().set(&apos;id&apos;,&apos;1&apos;)</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;app-root&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;ul *ngIf=&quot;user$ | async as users else noData&quot;&gt;</span><br><span class="line">      &lt;li *ngFor=&quot;let user of users&quot;&gt;</span><br><span class="line">        &lt;span&gt;Name: &#123;&#123;user.name&#125;&#125;&lt;/span&gt; | </span><br><span class="line">        &lt;span&gt;id: &#123;&#123;user.id&#125;&#125;&lt;/span&gt; | </span><br><span class="line">        &lt;span&gt;age: &#123;&#123;user.age&#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  `,</span><br><span class="line">  styleUrls: [&apos;./app.component.css&apos;]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  user$: Observable&lt;User[]&gt;;</span><br><span class="line">  constructor(private http: HttpClient) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.user$ = this.http</span><br><span class="line">      .get&lt;User[]&gt;(</span><br><span class="line">        &apos;http://localhost:3000/user&apos; , &#123;params&#125;</span><br><span class="line">      )</span><br><span class="line">      .pipe(tap(console.log));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>params用来设置请求的具体参数。set里面的第一个参数为参数名，第二个为具体参数，用于控制返回请求内容的特定参数名下的某个特定参数。</p>
</blockquote>
<blockquote>
<p>set可以设置多个，这里需要注意，这里设置多个的请求参数，他们之间为&amp;&amp;关系，所以请求回的数据一定在这些参数的交集范围内。</p>
</blockquote>
<h3 id="使用HttpHeaders"><a href="#使用HttpHeaders" class="headerlink" title="使用HttpHeaders"></a>使用HttpHeaders</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">const params = new HttpParams().set(&apos;id&apos;,&apos;1&apos;)</span><br><span class="line">const headers = new HttpHeaders().set(&apos;token&apos;,&apos;sin&apos;)</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  ...</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.user$ = this.http</span><br><span class="line">      .get&lt;User[]&gt;(</span><br><span class="line">        &apos;http://localhost:3000/user&apos; , &#123;headers,params&#125;</span><br><span class="line">      )</span><br><span class="line">      .pipe(tap(console.log));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>使用浏览器的开发者工具，可以在Network - all中查看请求的文件，然后可以发现Access-Control-Request-Headers的内容是与设置的请求头参数一致的。</p>
</blockquote>
<blockquote>
<p>请求头主要用于客户端浏览器、请求页面和服务器相关信息的说明，方便我们可以查看请求的相关信息等。</p>
</blockquote>
<h2 id="Put请求"><a href="#Put请求" class="headerlink" title="Put请求"></a>Put请求</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">const params = new HttpParams().set(&apos;id&apos;,&apos;1&apos;)</span><br><span class="line">const headers = new HttpHeaders().set(&quot;Content-type&quot;,&quot;application/json; charset=UTF-8&quot;)</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  ...</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.putHttp();</span><br><span class="line">    this.user$ = this.http</span><br><span class="line">      .get&lt;User[]&gt;(</span><br><span class="line">        &apos;http://localhost:3000/user&apos; , &#123;headers,params&#125;</span><br><span class="line">      )</span><br><span class="line">      .pipe(tap(console.log));</span><br><span class="line">  &#125;</span><br><span class="line">  putHttp()&#123;</span><br><span class="line">    this.http.put(&apos;http://localhost:3000/user/1&apos;,&#123;</span><br><span class="line">        name: &apos;gww&apos;,</span><br><span class="line">        id: &apos;1&apos;,</span><br><span class="line">        age: &apos;30&apos;</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        headers</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    .subscribe(val=&gt;&#123;</span><br><span class="line">      console.log(&apos;Put请求执行成功&apos;,val);</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      console.log(&apos;Put请求执行失败&apos;,error);</span><br><span class="line">    &#125;,</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      console.log(&apos;Put请求执行完成了&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>配合Get请求，可以看到此时的id为1的相关数据已经被更改。</p>
</blockquote>
<blockquote>
<p>Put请求地址需要为具体的某个数据的地址，例如上述demo中的’<a href="http://localhost:3000/user/1&#39;，其实就是id为1的数据的地址。" target="_blank" rel="noopener">http://localhost:3000/user/1&#39;，其实就是id为1的数据的地址。</a></p>
</blockquote>
<h2 id="Patch请求"><a href="#Patch请求" class="headerlink" title="Patch请求"></a>Patch请求</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">const params = new HttpParams().set(&apos;id&apos;,&apos;2&apos;)</span><br><span class="line">const headers = new HttpHeaders().set(&quot;Content-type&quot;,&quot;application/json; charset=UTF-8&quot;)</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  ...</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.patchHttp();</span><br><span class="line">    this.user$ = this.http</span><br><span class="line">      .get&lt;User[]&gt;(</span><br><span class="line">        &apos;http://localhost:3000/user&apos; , &#123;headers,params&#125;</span><br><span class="line">      )</span><br><span class="line">      .pipe(tap(console.log));</span><br><span class="line">  &#125;</span><br><span class="line">  patchHttp()&#123;</span><br><span class="line">    this.http.patch(&apos;http://localhost:3000/user/2&apos;,&#123;</span><br><span class="line">      name:&apos;ExplorerCl&apos;</span><br><span class="line">    &#125;,&#123;headers&#125;)</span><br><span class="line">    .subscribe(val=&gt;&#123;</span><br><span class="line">        console.log(&apos;patch请求执行成功&apos;,val);</span><br><span class="line">      &#125;,</span><br><span class="line">      error =&gt; &#123;</span><br><span class="line">        console.log(&apos;patch请求执行失败&apos;,error);</span><br><span class="line">      &#125;,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        console.log(&apos;patch请求执行完成了&apos;);</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>Patch请求用于更新单个数据内的部分参数。</p>
</blockquote>
<h2 id="Put与Patch请求的区别"><a href="#Put与Patch请求的区别" class="headerlink" title="Put与Patch请求的区别"></a>Put与Patch请求的区别</h2><p>Put请求和Patch请求在结果上看不出太大区别。</p>
<p>最大的区别在于，Put请求是产生一个新版本，然后用新版本将原版本替换掉。而Patch请求则是在原版本上进行更新改动。</p>
<p>并且，如果Patch请求的资源不存在，那么会依据Patch请求的内容，创建一个新的资源。</p>
<p>Patch请求适合用于增量修改，并且Patch如果要是用，一定要使用正确的方式，否则会产生一些副作用。</p>
<h2 id="post请求"><a href="#post请求" class="headerlink" title="post请求"></a>post请求</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">const params = new HttpParams().set(&apos;id&apos;,&apos;6&apos;)</span><br><span class="line">const headers = new HttpHeaders().set(&quot;Content-type&quot;,&quot;application/json; charset=UTF-8&quot;)</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  ...</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.postHttp();</span><br><span class="line">    this.user$ = this.http</span><br><span class="line">      .get&lt;User[]&gt;(</span><br><span class="line">        &apos;http://localhost:3000/user&apos; , &#123;headers,params&#125;</span><br><span class="line">      )</span><br><span class="line">      .pipe(tap(console.log))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  postHttp()&#123;</span><br><span class="line">    this.http.post(&apos;http://localhost:3000/user&apos;,&#123;</span><br><span class="line">      name:&apos;React&apos;,</span><br><span class="line">      id:&apos;6&apos;,</span><br><span class="line">      age:&apos;28&apos;</span><br><span class="line">    &#125;,&#123;headers&#125;)</span><br><span class="line">    .subscribe(val=&gt;&#123;</span><br><span class="line">	      console.log(&apos;post请求执行成功&apos;,val);</span><br><span class="line">	    &#125;,</span><br><span class="line">	    error =&gt; &#123;</span><br><span class="line">	      console.log(&apos;post请求执行失败&apos;,error);</span><br><span class="line">	    &#125;,</span><br><span class="line">	    () =&gt; &#123;</span><br><span class="line">	      console.log(&apos;post请求执行完成了&apos;);</span><br><span class="line">	    &#125;</span><br><span class="line">	 )</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>这里可以通过Get方法查看新增的数据，或者直接打开相应的json文件来看，可以发现多了一个id为6的内容。</p>
</blockquote>
<h2 id="Delete请求"><a href="#Delete请求" class="headerlink" title="Delete请求"></a>Delete请求</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">const headers = new HttpHeaders().set(&quot;Content-type&quot;,&quot;application/json; charset=UTF-8&quot;)</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  ...</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.deleteHttp()</span><br><span class="line">    this.user$ = this.http</span><br><span class="line">      .get&lt;User[]&gt;(</span><br><span class="line">        &apos;http://localhost:3000/user&apos; , &#123;headers&#125;</span><br><span class="line">      )</span><br><span class="line">      .pipe(tap(console.log))</span><br><span class="line">  &#125;</span><br><span class="line">  deleteHttp()&#123;</span><br><span class="line">    this.http.delete(&apos;http://localhost:3000/user/6&apos;,&#123;headers&#125;)</span><br><span class="line">    .subscribe(val=&gt;&#123;</span><br><span class="line">        console.log(&apos;delete请求执行成功&apos;,val);</span><br><span class="line">      &#125;,</span><br><span class="line">      error =&gt; &#123;</span><br><span class="line">        console.log(&apos;delete请求执行失败&apos;,error);</span><br><span class="line">      &#125;,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        console.log(&apos;delete请求执行完成了&apos;);</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>这里使用Delete请求，删除刚刚使用Post请求新增的数据，demo中请求都封装成方法，可以自己多次调用方法来查看各个请求的作用结果。</p>
</blockquote>
<h1 id="HttpClient拦截器"><a href="#HttpClient拦截器" class="headerlink" title="HttpClient拦截器"></a>HttpClient拦截器</h1><p>拦截器用于监听和转换从应用发送到服务器的HTTP请求，或者监视和转换从该服务器返回到本应用的那些响应。</p>
<p>拦截器可以用常规、标准的方式对每次的HTTP请求/响应任务执行从认证到记日志等多种的隐式任务，方便开发人员进行检查。</p>
<h2 id="一个空白拦截器"><a href="#一个空白拦截器" class="headerlink" title="一个空白拦截器"></a>一个空白拦截器</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123;Injectable&#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; HttpInterceptor, HttpRequest, HttpHandler, HttpEvent &#125; from &apos;@angular/common/http&apos;;</span><br><span class="line">import &#123; Observable &#125; from &apos;rxjs&apos;;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line">export class AutiInterceptor implements HttpInterceptor&#123;</span><br><span class="line">    </span><br><span class="line">    intercept(req:HttpRequest&lt;any&gt;, next:HttpHandler):</span><br><span class="line">        Observable&lt;HttpEvent&lt;any&gt;&gt; &#123;</span><br><span class="line">            return next.handle(req);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>这里的intercept()方法接收两个固定的参数：req:HttpRequest代表请求对象；next:HttoHandler表示拦截器链表中的下一个拦截器，让请求流能走到下一个拦截器，该对象下有一个handle()方法，该方法返回一个Observable对象。</p>
</blockquote>
<blockquote>
<p>拦截器无法修改原始的请求对象。</p>
</blockquote>
<h2 id="记录日志的拦截器"><a href="#记录日志的拦截器" class="headerlink" title="记录日志的拦截器"></a>记录日志的拦截器</h2><p>logging.interceptors.ts</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import &#123;Injectable&#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; HttpInterceptor, HttpRequest, HttpHandler &#125; from &apos;@angular/common/http&apos;;</span><br><span class="line">import &#123; finalize, tap &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line">export class LoggingInterceptor implements HttpInterceptor&#123;</span><br><span class="line"></span><br><span class="line">    intercept(req:HttpRequest&lt;any&gt;, next:HttpHandler)&#123;</span><br><span class="line">        const startTime = Date.now();</span><br><span class="line">        let status: string;</span><br><span class="line"></span><br><span class="line">        return next.handle(req).pipe(</span><br><span class="line">            tap(</span><br><span class="line">                event =&gt; status = event instanceof HttpRequest ? &apos;succeeded&apos; : &apos;&apos;,</span><br><span class="line">                error =&gt; status = &apos;failed&apos;</span><br><span class="line">            ),</span><br><span class="line">            finalize(()=&gt;&#123;</span><br><span class="line">                const elapsed = Date.now() - startTime;</span><br><span class="line">                const message = req.method + &quot; &quot; + req.urlWithParams + &quot; &quot; + status + &quot;in&quot; + elapsed + &quot;ms&quot;;</span><br><span class="line"></span><br><span class="line">                console.log(message)</span><br><span class="line">            &#125;)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="在AppModule中配置拦截器"><a href="#在AppModule中配置拦截器" class="headerlink" title="在AppModule中配置拦截器"></a>在AppModule中配置拦截器</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">import &#123; LoggingInterceptor &#125; from &apos;./logging.interceptors&apos;;</span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  ...</span><br><span class="line">  providers: [</span><br><span class="line">    &#123;provide: HTTP_INTERCEPTORS, useClass: LoggingInterceptor,multi:true&#125;</span><br><span class="line">  ],</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line">export class AppModule &#123; &#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p>这里只是demo，所以只有一个拦截器，正常项目下一般会有多个拦截器，这个时候就可以新建一个providers文件，用来存储所有拦截器的配置，然后把相应的providers文件配置在AppModule中。</p>
</blockquote>
<blockquote>
<p>这里的multi:true表示HTTP_INTERCEPTORS是一个多重提供商的令牌，表示它会注入一个多值的数组，而不是单个值。</p>
</blockquote>
<p>之后我们可以通过浏览器的开发者工具查看日志内容，每一个请求的请求时间都会在日志中被记录。</p>
<h1 id="总结和心得"><a href="#总结和心得" class="headerlink" title="总结和心得"></a>总结和心得</h1><p>五种请求其实看下来，很符合编程很常见的操作，增(post)删(delete)改(put、patch)查(get)，虽然部分的请求会有多种功能，但是按照正常思路而言，还是以最主要的功能来判断使用什么请求，避免不必要的麻烦。</p>
<p>拦截器的intercept()自带的req和next参数其实已经表明了，一个正规的网址一般会有多个拦截器共同去作用。拦截器的作用过程其实与过滤器有些相似，对特定的对象按照设定的要求做相应的操作。</p>
</div><div class="tags"><a href="/tags/angular/">angular</a></div><div class="post-nav"><a class="pre" href="/2018/10/10/自定义表单验证与跨字段交叉验证学习归纳/">自定义表单验证与跨字段交叉验证学习归纳</a><a class="next" href="/2018/09/14/路由的学习归纳/">路由的学习归纳</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Angular/">Angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/总结/" style="font-size: 15px;">总结</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Angular/" style="font-size: 15px;">Angular</a> <a href="/tags/angular/" style="font-size: 15px;">angular</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/2018年总结/">2018年总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/ElementRef的学习归纳/">ElementRef的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/自定义表单验证与跨字段交叉验证学习归纳/">自定义表单验证与跨字段交叉验证学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/25/HttpClient的学习归纳/">HttpClient的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/路由的学习归纳/">路由的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/Hexo博客多终端管理/">Hexo博客多终端管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/表单学习归纳/">表单学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/绑定的学习归纳/">绑定的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/自定义指令的学习归纳/">自定义指令的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/管道的学习归纳/">管道学习归纳</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.semlinker.com/" title="前端修仙之路" target="_blank">前端修仙之路</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">七罪的前端学习小天地.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>