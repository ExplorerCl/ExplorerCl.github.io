<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="angular"><title>自定义表单验证与跨字段交叉验证学习归纳 | 七罪的前端学习小天地</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">自定义表单验证与跨字段交叉验证学习归纳</h1><a id="logo" href="/.">七罪的前端学习小天地</a><p class="description">欢迎一起来探索前端的道路</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">自定义表单验证与跨字段交叉验证学习归纳</h1><div class="post-meta">Oct 10, 2018<span> | </span><span class="category"><a href="/categories/Angular/">Angular</a></span></div><div class="post-content"><h1 id="自定义表单验证"><a href="#自定义表单验证" class="headerlink" title="自定义表单验证"></a>自定义表单验证</h1><h2 id="模板驱动式表单的自定义表单验证"><a href="#模板驱动式表单的自定义表单验证" class="headerlink" title="模板驱动式表单的自定义表单验证"></a>模板驱动式表单的自定义表单验证</h2><p>模板驱动式表单中，因为不能直接访问<code>FormControl</code>实例，所以无法直接传入。这时候就可以考虑在模板中添加一个指令，利用指令来包装自定义验证函数，然后添加到<code>FormControl</code>中。</p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><ul>
<li><code>AppModule</code></li>
</ul>
<p>首先将表单模组添加到<code>AppModule</code>中。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; BrowserModule &#125; from &apos;@angular/platform-browser&apos;;</span><br><span class="line">import &#123; NgModule &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; FormsModule, ReactiveFormsModule &#125; from &apos;@angular/forms&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; AppComponent &#125; from &apos;./app.component&apos;;</span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  declarations: [</span><br><span class="line">    AppComponent</span><br><span class="line">  ],</span><br><span class="line">  imports: [</span><br><span class="line">    BrowserModule,</span><br><span class="line">    FormsModule,</span><br><span class="line">    ReactiveFormsModule</span><br><span class="line">  ],</span><br><span class="line">  providers: [],</span><br><span class="line">  bootstrap: [AppComponent]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppModule &#123; &#125;</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li>模板</li>
</ul>
<p>接着写一个简单的模板驱动式表单。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form novalidate #f=&quot;ngForm&quot;&gt;</span><br><span class="line">  &lt;label&gt;手机号&lt;/label&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; placeholder=&quot;请输入您的手机号码&quot; name=&quot;phone&quot; ngModel #phone=&quot;ngModel&quot;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li>指令</li>
</ul>
<p>编写指令，在指令中写验证函数。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Directive &#125; from &quot;@angular/core&quot;;</span><br><span class="line">import &#123; NG_VALIDATORS, Validator, AbstractControl &#125; from &quot;@angular/forms&quot;;</span><br><span class="line"></span><br><span class="line">@Directive(&#123;</span><br><span class="line">    selector:&apos;[phoneNumber]&apos;,</span><br><span class="line">    providers:[&#123;provide:NG_VALIDATORS, useExisting:PhoneNumberDirective,multi:true&#125;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export class PhoneNumberDirective implements Validator &#123;</span><br><span class="line">    validate(c:AbstractControl):&#123;[key:string]:any&#125; | null &#123;</span><br><span class="line">        let value:string = c.value || &apos;&apos;;</span><br><span class="line">        if(!value.startsWith(&apos;1&apos;))&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                mobile:&#123;</span><br><span class="line">                    msg:&apos;请输入正确的手机号码&apos;,</span><br><span class="line">                    actualValue:value</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            if(!(value.length === 11))&#123;</span><br><span class="line">                return &#123;</span><br><span class="line">                    mobile:&#123;</span><br><span class="line">                        msg:&apos;请输入正确的手机长度&apos;,</span><br><span class="line">                        actualValue:value</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><p>这里的<code>providers</code>中必须使用<code>useExisting</code>而不是<code>useClass</code>，这是因为使用<code>useClass</code>会创建一个新的类实例。</p>
<ul>
<li>更新<code>AppModule</code></li>
</ul>
<p>将指令添加到<code>AppModule</code>中。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">import &#123; PhoneNumberDirective &#125; from &apos;./phoneNumber.directive&apos;;</span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  declarations: [</span><br><span class="line">    AppComponent,</span><br><span class="line">    PhoneNumberDirective</span><br><span class="line">  ],</span><br><span class="line">  imports: [...],</span><br><span class="line">  providers: [],</span><br><span class="line">  bootstrap: [...]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppModule &#123; &#125;</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li>更新表单代码</li>
</ul>
<p>最后将指令写入表单对应的位置。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form novalidate #f=&quot;ngForm&quot;&gt;</span><br><span class="line">  &lt;label&gt;手机号&lt;/label&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; placeholder=&quot;请输入您的手机号码&quot; name=&quot;phone&quot; phoneNumber ngModel #phone=&quot;ngModel&quot;/&gt;</span><br><span class="line">    &lt;span *ngIf=&quot;phone.errors?.mobile&quot;&gt;&#123;&#123;phone.errors?.mobile.msg&#125;&#125;&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="响应式表单的自定义表单验证"><a href="#响应式表单的自定义表单验证" class="headerlink" title="响应式表单的自定义表单验证"></a>响应式表单的自定义表单验证</h2><p>响应式表单的自定义表单验证函数可以直接写在对应的组件中，然后通过<code>FormGroup</code>、<code>FormControl</code>和<code>FormBuilder</code>（可选）来设置该函数的使用。</p>
<h3 id="Demo-1"><a href="#Demo-1" class="headerlink" title="Demo"></a>Demo</h3><p><code>AppModule</code>导入和模板驱动式表单相同。</p>
<ul>
<li>表单</li>
</ul>
<p>先写一个简单的响应式表单<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;form novalidate [formGroup]=&quot;codeGroup&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">    &lt;label for=&quot;codeId&quot;&gt;请输入验证码:&lt;/label&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input type=&quot;text&quot; id=&quot;codeId&quot; placeholder=&quot;请输入验证码&quot; formControlName=&quot;code&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>对应的<code>Component.ts</code>文件</li>
</ul>
<p>编写验证函数并且使用。<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; ValidatorFn, AbstractControl, FormGroup, FormBuilder &#125; from &apos;@angular/forms&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;app-root&apos;,</span><br><span class="line">  templateUrl: &apos;./app.component.html&apos;,</span><br><span class="line">  styleUrls: [&apos;./app.component.css&apos;]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit&#123;</span><br><span class="line">  constructor(private fb: FormBuilder)&#123;&#125;</span><br><span class="line"></span><br><span class="line">  codeGroup:FormGroup;</span><br><span class="line">  code = Math.ceil(Math.random() * 10000);</span><br><span class="line">  </span><br><span class="line">  ngOnInit()&#123;</span><br><span class="line">    console.log(&apos;code&apos;,this.code);</span><br><span class="line">    this.codeGroup = this.fb.group(&#123;</span><br><span class="line">      code:[&apos;&apos;,VerificationCode(this.code)]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function VerificationCode(number):ValidatorFn&#123;</span><br><span class="line">  return (c:AbstractControl) : &#123;[key:string]:any&#125; | null =&gt; &#123;</span><br><span class="line">    let age = c.value;</span><br><span class="line">    let code = number;</span><br><span class="line">    if(age == code)&#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        &apos;code&apos;:true,</span><br><span class="line">        &apos;msg&apos;:&apos;验证成功&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        &apos;code&apos;:true,</span><br><span class="line">        &apos;msg&apos;:&apos;验证失败&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里的<code>code</code>作为回调值，一般配合<code>NgIf</code>来设置验证提示。</p>
<ul>
<li>更新表单</li>
</ul>
<p>在组件中已经设置了一个随机生成数字的变量，然后使用插值表达式来展示在页面中<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;form novalidate [formGroup]=&quot;codeGroup&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;form-group&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;label for=&quot;codeId&quot;&gt;验证码:&#123;&#123;code&#125;&#125;&lt;/label&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input type=&quot;text&quot; </span><br><span class="line">          id=&quot;codeId&quot;</span><br><span class="line">          placeholder=&quot;请输入验证码&quot;</span><br><span class="line">          formControlName=&quot;code&quot; /&gt;</span><br><span class="line">      &lt;span *ngIf=&quot;codeGroup.get(&apos;code&apos;).errors?.code&quot;&gt;</span><br><span class="line">		&#123;&#123;codeGroup.get(&apos;code&apos;).errors?.msg&#125;&#125;</span><br><span class="line">	  &lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="过程中遇到的问题"><a href="#过程中遇到的问题" class="headerlink" title="过程中遇到的问题"></a>过程中遇到的问题</h3><p>首先需要注意，在使用<code>formGroup</code>的时候，其命名后面也需要带<code>Group</code>，例如<code>[formGroup]=&quot;codeGroup&quot;</code>。如果使用例如<code>[formGroup]=&quot;code&quot;</code>的命名，则会出现报错提示:<code>ERROR Error: formGroup expects a FormGroup instance. Please pass one in.</code>。</p>
<p>并且需要要注意区分大小写，无论是<code>formGroup</code>还是<code>formControl</code>，否则也会出现报错。</p>
<h1 id="跨字段交叉验证"><a href="#跨字段交叉验证" class="headerlink" title="跨字段交叉验证"></a>跨字段交叉验证</h1><h2 id="Demo-2"><a href="#Demo-2" class="headerlink" title="Demo"></a>Demo</h2><p><code>AppModule</code>导入和上面相同。</p>
<ul>
<li>表单</li>
</ul>
<p>编写一个简单的嵌套表单</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;form novalidate [formGroup]=&quot;signupGroup&quot;&gt;</span><br><span class="line">  &lt;div formGroupName=&quot;emailGroup&quot;&gt;</span><br><span class="line">    &lt;label for=&quot;emailId&quot;&gt;邮箱&lt;/label&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input id=&quot;emailId&quot; type=&quot;email&quot; placeholder=&quot;请输入邮箱&quot; </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;label id=&quot;confirmEmailId&quot;&gt;确认邮箱&lt;/label&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input id=&quot;confirmEmailId&quot; type=&quot;email&quot; placeholder=&quot;请再次输入邮箱&quot; formControlName=&quot;confirmEmail&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li>对应的<code>Component.ts</code>文件</li>
</ul>
<p>编写验证函数并且使用。<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; ValidatorFn, AbstractControl, FormGroup, FormBuilder, Validators, ValidationErrors &#125; from &apos;@angular/forms&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;app-root&apos;,</span><br><span class="line">  templateUrl: &apos;./app.component.html&apos;,</span><br><span class="line">  styleUrls: [&apos;./app.component.css&apos;]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit&#123;</span><br><span class="line">  constructor(private fb: FormBuilder)&#123;&#125;</span><br><span class="line"></span><br><span class="line">  signupGroup:FormGroup;</span><br><span class="line"></span><br><span class="line">  ngOnInit()&#123;</span><br><span class="line">    this.signupGroup = this.fb.group(&#123;</span><br><span class="line">      emailGroup:this.fb.group(&#123;</span><br><span class="line">        email:[&apos;&apos;,[Validators.required,Validators.email]],</span><br><span class="line">        confirmEmail:[&apos;&apos;,[Validators.required]],</span><br><span class="line">      &#125;,&#123;validator:emailMatcher&#125;),</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const emailMatcher:ValidatorFn = (control:FormGroup):ValidationErrors | null =&gt;&#123;</span><br><span class="line">  const email = control.get(&apos;email&apos;);</span><br><span class="line">  const confirmemail = control.get(&apos;confirmEmail&apos;);</span><br><span class="line"></span><br><span class="line">  if(email.pristine || confirmemail.pristine) &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  return email.value === confirmemail.value ? null : &#123;&apos;match&apos;:true&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里需要注意，这个验证函数使用时候是要写在嵌套层的父级，也就是这里的<code>emailGroup</code>的后面。</p>
<h3 id="基于AbstractControl的跨字段交叉验证"><a href="#基于AbstractControl的跨字段交叉验证" class="headerlink" title="基于AbstractControl的跨字段交叉验证"></a>基于<code>AbstractControl</code>的跨字段交叉验证</h3><p>这里只是验证函数写法不一样，其他没有变化，同上即可。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function emailMatcher(c:AbstractControl) &#123;</span><br><span class="line">  let emailControl = c.get(&apos;email&apos;);</span><br><span class="line">  let confirmControl = c.get(&apos;confirmEmail&apos;);</span><br><span class="line">  if(emailControl.pristine || confirmControl.pristine) &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  return emailControl.value === confirmControl.value ? null : &#123;&apos;match&apos;:true&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><blockquote>
<p><code>AbstractControl</code>还有其他多个属性，并且有同步验证函数接口和异步函数接口的区别。这里使用的是异步验证函数接口。约定方法为<code>(c:AbstractControl):any</code>，这里的用来写Demo，并且没有出现报错，故而省略<code>:any</code>，在正式开发过程中请不要省略这部分。</p>
</blockquote>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>跨字段交叉验证是自定义表单验证的其中一种，只是因为较为特殊所以另外拿出来写demo。<br>在使用自定义验证表单时，需要多注意区分两个表单的使用过程。</p>
<p>并且在angular 6.x版本之后，最好使用各自的错误写法。例如：模板驱动式表单 - (name.errors.required)，响应式表单 - (fromGroup.get(‘formControlName’.hasError(‘required’))。参考资料：<a href="https://angular.io/api/forms/FormControlName" target="_blank" rel="noopener">Angular官网 - FormControlName</a></p>
</div><div class="tags"><a href="/tags/Angular/">Angular</a></div><div class="post-nav"><a class="next" href="/2018/09/25/HttpClient的学习归纳/">HttpClient的学习归纳</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Angular/">Angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Angular/" style="font-size: 15px;">Angular</a> <a href="/tags/angular/" style="font-size: 15px;">angular</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/自定义表单验证与跨字段交叉验证学习归纳/">自定义表单验证与跨字段交叉验证学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/25/HttpClient的学习归纳/">HttpClient的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/路由的学习归纳/">路由的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/Hexo博客多终端管理/">Hexo博客多终端管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/表单学习归纳/">表单学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/自定义指令的学习归纳/">自定义指令的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/绑定的学习归纳/">绑定的学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/管道的学习归纳/">管道学习归纳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/博客说明/">关于本博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/依赖注入学习归纳/">依赖注入学习归纳</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.semlinker.com/" title="前端修仙之路" target="_blank">前端修仙之路</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">七罪的前端学习小天地.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>